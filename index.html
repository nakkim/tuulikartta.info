<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="IE=edge">
        <!-- <meta name="apple-mobile-web-app-capable" content="yes"> -->
	    <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <title>Pintatuulihavainnot kartalla - tuulikartta.info</title>
        <meta name="description" content="Säähavaintoja Ilmatieteen laitoksen avoimen datan avulla."/>
        <meta name="rating" content="Safe For Kids"/>
        <meta name="author" content="Ville Ilkka"/>
        <meta name="robots" content="index,follow"/>
        <meta name="robots" content="noodp"/>

        <link rel="icon" type="image/png" href="favicon/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="favicon/favicon-16x16.png" sizes="16x16">

        <title>tuulikartta.info - säähavainnot kartalla</title>

        <script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>
        <link href="//fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
        <link href="//fonts.googleapis.com/css?family=Lato" rel="stylesheet">

        <!-- moment.js -->
        <script src="js/vendor/moment.js"></script>

        <!-- jQuery -->
        <script type="text/javascript" src="js/vendor/jQuery.js"></script>

        <!-- bootstrap datepicker -->
        <link id="bs-css" href="css/bootstrap.min.css" rel="stylesheet">
        <link id="bsdp-css" href="css/bootstrap-datepicker.min.css" rel="stylesheet">
        <script src="js/vendor/bootstrap-datepicker.min.js"></script>
        <script src="js/vendor/bootstrap-datepicker.fi.min.js"></script>

        <!-- owl carousel -->
        <link rel="stylesheet" href="css/owl.carousel.css">
        <link rel="stylesheet" href="css/owl.theme.default.css">
        <script src="js/vendor//owl.carousel.min.js"></script>

        <!-- leaflet.js -->
        <link rel="stylesheet" href="css/leaflet.css" />
        <script src="js/vendor/leaflet.js"></script>
        <script src="js/vendor/leaflet.rotatedMarker.js"></script>
        <script src="js/vendor/leaflet.responsive.popup.js"></script>
        <link rel="stylesheet" href="css/leaflet.responsive.popup.css" />

        <!-- highcharts -->
        <script src="js/vendor/highstock.js"></script>
        <script src="js/vendor//highcharts-more.js"></script>
        <script src="js/vendor/windbarb.src.js"></script>

        <script src="js/main.js"></script>
        <script src="js/graph.js"></script>

        <link href="css/style.css" rel="stylesheet">
        <link href="css/temperature.css" rel="stylesheet">


        <script>
        $(document).ready(function() {
            var cal = $('#datepicker-button').datepicker({
                language: 'fi',
                format: 'dd.mm.yyyy',
                endDate: '+0d',
                autoclose: true,
                todayBtn: true,
                defaultDate: new Date()
            });
            cal.datepicker("setDate",'now');
        })
        </script>

    </head>

    <body>

        <div id="gui-box" class="data-info" style="display: block">
            <div class="data-info-wrapper" align=center>
                <div class="select-box">

                    <span class="select-content-wrapper" id="select-content-wrapper-timeselector">
                        <input id="datepicker-button" class="select-button" style="text-align:center;max-width:105px;">
                        <input id="clockpicker-button" class="select-button" style="text-align:center; max-width:60px;">      
                        <span class="ph-float">
                            <a href='#' id="select-content-datasearch" class='ph-button ph-btn-blue inactive'>Hae</a>
                        </span>
                    </span>

                    <span id="select-content-wrapper-time" class="select-content-wrapper">
                        <button id="timepicker-regress-time" class="select-button">&laquo; 1h</button>
                        <span class="ph-float">
                            <a href='#' id="select-content-now" class='ph-button ph-btn-blue'>Nyt</a>
                        </span>
                        <button id="timepicker-progress-time" class="select-button">1h &raquo;</button>  
                    </span>
                </div>
            </div>
        </div>

        <div class="leaflet-top leaflet-left leaflet-control control-center" id="map-param">
            <div class="settings"></div>
            <span class="select-content-wrapper" id="main-navbar-param">
                <select id="select-wind-parameter" class="select-style" style="height:26px;">
                    <option value="ws_10min">Keskituuli</option>
                    <option value="wg_10min">Maksimipuuska</option>
                    <option value="ws_1h">Tunnin suurin keskituuli</option>
                    <option value="wg_1h">Tunnin maksimipuuska</option>
                    <option value="ri_10min">Sateen intensiteetti</option>
                    <option value="rr_1h">Tunnin sadekertymä</option>
                    <option value="t2m">Lämpötila</option>
                    <option value="vis">Näkyvyys</option>
                    <option value="wawa">Vallitseva sää</option>
                    <option value="n_man">Kokonaispilvisyys</option>
                    <option value="snow_aws">Lumensyvyys</option>
                </select>
            </span>
        </div>

        <div class="leaflet-bottom leaflet-left leaflet-control-attribution leaflet-control">
            <div id="data-loader" class="info-container-data">
                Ladataan havaintoja... <img src='symbols/default.gif' style='width:20px;'></img>
            </div>
            <div id="site-info" class="info-container" style="display:none;">
                <p style="line-height: 150%">
                    <a href="tietoa-sivustosta/">Tietoa sivustosta</a>
                </p>
                <p style="line-height: 150%">
                    <span style="color:#343434; font-weight:bold;">Tuulikartta.info</span> - säähavaintoja (lähes) reaaliajassa.</br>
                    Säähavaintoaineistoa Ilmatieteen laitoksen havaintoasemilta sekä Liikenneviraston tiesääasemilta. </br>
                    Tuulikartta.info perustuu Ilmatieteen laitoksen <a href="https://ilmatieteenlaitos.fi/avoin-data">avoimeen dataan.</a>
                </p>
                <p>
                    Seuraa sivuston kehitystä sekä kehittäjän edesottamuksia:
                </p>
                <a href="https://twitter.com/viilkka" class="twitter-follow-button" data-show-count="false">Follow</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
                <a href="https://twitter.com/intent/tweet?screen_name=viilkka" class="twitter-mention-button" data-show-count="false">Tweet to @viilkka</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
            </div>
        </div>

        <div id="map" styles="z-index:1"></div>

    </body >

    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-105001415-1', 'auto');
        ga('send', 'pageview');

    </script>
    <script>

        var hash = window.location.hash.split('#')
        var latitude = localStorage.getItem('latitude') ? localStorage.getItem('latitude') : 65.69,
            longitude = localStorage.getItem('longitude') ? localStorage.getItem('longitude') : 25.36,
            zoomlevel = localStorage.getItem('zoomlevel') ? localStorage.getItem('zoomlevel') : 5,
            selectedParam = 'ws_10min'

        var values = ['ws_10min','wg_10min','ws_1h','wg_1h','ri_10min','rr_1h','t2m','vis','wawa','n_man','snow_aws']

        hash.forEach(function(element) { 
            var param = element.split('=');
            if(param[0] === 'latlon') {
                var lat = param[1].split(',')[0]
                var lon = param[1].split(',')[1]
                var zoom = param[1].split(',')[2]

                if(typeof(parseFloat(lat)) === 'number' && parseFloat(lat) >= -90 && parseFloat(lat) <= 90) latitude = lat
                if(typeof(parseFloat(lon)) === 'number' && parseFloat(lon) >= -180 && parseFloat(lat) <= 180) longitude = lon
                if(typeof(parseFloat(zoom)) === 'number' && parseFloat(zoom) >= 5 && parseFloat(zoom) <= 12) zoomlevel = zoom

            }
            if(param[0] === 'zoom') {
                var zoom = param[1]

                if(typeof(parseInt(zoom)) === 'number' && parseInt(zoom) >= 5 && parseInt(zoom) <= 12) zoomlevel = zoom
            }
            if(param[0] === 'parameter') {
                if(values.includes(param[1])) {
                    selectedParam = param[1]
                    document.getElementById('select-wind-parameter').value = selectedParam;
                }
            }
        })
        saa.Tuulikartta.handleUrlParams(latitude,longitude,zoomlevel,selectedParam)

        saa.Tuulikartta.callData();
        saa.Tuulikartta.initMap();

    </script>

</html>
