<!DOCTYPE html>
<html>
    <head>
        <link rel="manifest" href="/manifest.json">
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="IE=edge">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link rel="apple-touch-icon" href="favicon/android-chrome-192x192.png">
        <meta name="theme-color" content="#397CAC">
        <title>Tuulikartta</title>
        
        <link rel="alternate" hreflang="fi" href="https://www.tuulikartta.info/index.html"/>
        <link rel="alternate" hreflang="en" href="https://www.tuulikartta.info/index.html#lang=en"/>

        <meta name="description" content="Säähavaintoja Ilmatieteen laitoksen avoimen datan avulla."/>
        <meta name="rating" content="Safe For Kids"/>
        <meta name="author" content="Ville Ilkka"/>
        <meta name="robots" content="index,follow"/>
        <meta name="robots" content="noodp"/>

        <link rel="icon" type="image/png" href="favicon/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="favicon/favicon-16x16.png" sizes="16x16">

        <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>
        <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">

        <!-- moment.js -->
        <script src="node_modules/moment/moment.js"></script>

        <!-- jQuery -->
        <script src="node_modules/jquery/dist/jquery.min.js"></script>

        <!-- bootstrap datepicker -->
        <link rel="stylesheet" href="node_modules/bootstrap-datepicker/dist/css/bootstrap-datepicker.standalone.css"/>
        <script src="node_modules/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
        <script src="node_modules/bootstrap-datepicker/dist/locales/bootstrap-datepicker.fi.min.js"></script>

        <!-- owl carousel -->
        <link rel="stylesheet" href="node_modules/owl.carousel/dist/assets/owl.carousel.min.css">
        <link rel="stylesheet" href="node_modules/owl.carousel/dist/assets/owl.theme.default.min.css">
        <script src="node_modules/owl.carousel/dist/owl.carousel.min.js"></script>

        <!-- leaflet.js -->
        <link rel="stylesheet" href="node_modules/leaflet/dist/leaflet.css">
        <script src="node_modules/leaflet/dist/leaflet.js"></script>
        <script src="node_modules/leaflet-rotatedmarker/leaflet.rotatedMarker.js"></script>
        <script src="node_modules/leaflet-responsive-popup/leaflet.responsive.popup.js"></script>
        <link rel="stylesheet" href="node_modules/leaflet-responsive-popup/leaflet.responsive.popup.css" />
        <link rel="stylesheet" href="css/Leaflet-sidebar.css" />
        <script src="node_modules/leaflet-sidebar/src/L.Control.Sidebar.js"></script>
        <script src="node_modules/leaflet.locatecontrol/dist/L.Control.Locate.min.js"></script>
        <script src="node_modules/spin.js/spin.min.js"></script>
        <script src="node_modules/leaflet-spin/leaflet.spin.min.js"></script>

        <!-- highcharts -->
        <script src="node_modules/highcharts/highcharts.js"></script>
        <script src="node_modules/highcharts/highcharts-more.js"></script>
        <script src="node_modules/highcharts/modules/windbarb.js"></script>

        <script src="js/translations.js?v=2"></script>
        <script src="js/main.js?v=2"></script>
        <script src="js/graph.js?v=2"></script>
        <script src="js/lightning.js?v=2"></script>

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />
        <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>

        <link href="css/style.css" rel="stylesheet">
        <link href="css/temperature.css" rel="stylesheet">

        <script src="serviceWorker.js"></script>

        <script>
        $(document).ready(function() {
            var cal = $('#datepicker-button').datepicker({
                language: 'fi',
                format: 'dd.mm.yyyy',
                endDate: '+0d',
                autoclose: true,
                todayBtn: true,
                defaultDate: new Date()
            });
            cal.datepicker("setDate",'now');
        })
        </script>

    </head>

    <body>

        <div id="gui-box" class="data-info" style="display: block">
            <div class="data-info-wrapper" align=center>
                <div class="select-box">

                    <span class="select-content-wrapper" id="select-content-wrapper-timeselector">
                        <input id="datepicker-button" class="select-button" style="text-align:center;max-width:105px;">
                        <input id="clockpicker-button" class="select-button" style="text-align:center; max-width:60px;">      
                        <span class="ph-float">
                            <a href='#' id="select-content-datasearch" class='ph-button ph-btn-blue inactive'></a>
                        </span>
                    </span>

                    <span id="select-content-wrapper-time" class="select-content-wrapper">
                        <button id="timepicker-regress-time" class="select-button">&laquo; 1h</button>
                        <span class="ph-float">
                            <a href='#' id="select-content-now" class='ph-button ph-btn-blue'></a>
                        </span>
                        <button id="timepicker-progress-time" class="select-button">1h &raquo;</button>  
                    </span>
                </div>
                <span class="language-selector">
                    <button id="language-selector-value" class="select-button">FI</button>
                </span>
            </div>
        </div>

        <div class="leaflet-top leaflet-left leaflet-control control-center" id="map-param">
            <div class="settings"></div>
            <span class="select-content-wrapper" id="main-navbar-param"></span>
        </div>

        <div class="leaflet-bottom leaflet-left leaflet-control-attribution leaflet-control">
            <div id="data-loader" class="info-container-data"></div>
            <div id="site-info" class="info-container" style="display:none;">
                <div id="site-info-body"></div>
                <a href="https://twitter.com/viilkka" class="twitter-follow-button" data-show-count="false">Follow</a><script async src="https:////platform.twitter.com/widgets.js" charset="utf-8"></script>
                <a href="https://twitter.com/intent/tweet?screen_name=viilkka" class="twitter-mention-button" data-show-count="false">Tweet to @viilkka</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
            </div>
        </div>

        <div id="map" styles="z-index:1"></div>
        <div id="settings-sidebar"></div>

    </body >

    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    </script>
    <script>

        var hash = window.location.hash.split('#')
        var latitude = localStorage.getItem('latitude') ? localStorage.getItem('latitude') : 65.69,
            longitude = localStorage.getItem('longitude') ? localStorage.getItem('longitude') : 25.36,
            zoomlevel = localStorage.getItem('zoomlevel') ? localStorage.getItem('zoomlevel') : 5,
            selectedLanguage = localStorage.getItem('language') ? localStorage.getItem('language') : 'fi',
            selectedParam = 'ws_10min'

        if(selectedLanguage === 'fi')
        $('#language-selector-value').html('EN')
        if(selectedLanguage === 'en')
        $('#language-selector-value').html('FI')

        window.cookieconsent.initialise({
          palette: {
            popup: {
              background: "white",
              text: "black",
            },
            button: {
              background: "#3f8abf",
              message: "OK"
            }
          },
          theme: "classic",
          showLink: false,
          content: {
            message: translations[selectedLanguage]['cookieConsent'],
            dismiss: translations[selectedLanguage]['consent'],
          }
        });

        $('#select-content-datasearch').html(translations[selectedLanguage]['dataSearch'])
        $('#select-content-now').html(translations[selectedLanguage]['dataNow'])

        /* get language from url parameter */
        hash.forEach(function(element) {
            var param = element.split('=');
            if(param[0] === 'lang') {
                if(param[1] === 'en') {
                    selectedLanguage = 'en'
                    localStorage.setItem('language', 'en')
                } else if(param[1] === 'fi') {
                    selectedLanguage = 'fi'
                    localStorage.setItem('language', 'fi')
                } else {
                    selectedLanguage = 'fi'
                    localStorage.setItem('language', 'fi')
                }
            }
        })

        saa.Tuulikartta.buildObservationMenu()
        saa.Tuulikartta.populateInfoContent()
        var values = ['ws_10min','wg_10min','ws_1d','wg_1d','ri_10min','rr_1h','rr_1d','t2m','tmax','tmin','vis','wawa','n_man','snow_aws','pressure','rh']

        /* handle other url parameters */
        hash.forEach(function(element) { 
            var param = element.split('=');
            if(param[0] === 'latlon') {
                var lat = param[1].split(',')[0]
                var lon = param[1].split(',')[1]
                var zoom = param[1].split(',')[2]

                if(typeof(parseFloat(lat)) === 'number' && parseFloat(lat) >= -90 && parseFloat(lat) <= 90) latitude = lat
                if(typeof(parseFloat(lon)) === 'number' && parseFloat(lon) >= -180 && parseFloat(lat) <= 180) longitude = lon
                if(typeof(parseFloat(zoom)) === 'number' && parseFloat(zoom) >= 5 && parseFloat(zoom) <= 12) zoomlevel = zoom

            }
            if(param[0] === 'zoom') {
                var zoom = param[1]

                if(typeof(parseInt(zoom)) === 'number' && parseInt(zoom) >= 5 && parseInt(zoom) <= 12) zoomlevel = zoom
            }
            if(param[0] === 'parameter') {
                if(values.includes(param[1])) {
                    selectedParam = param[1]
                    document.getElementById('select-wind-parameter').value = selectedParam;
                }
            }
        })
        saa.Tuulikartta.handleUrlParams(latitude,longitude,zoomlevel,selectedParam)

        saa.Tuulikartta.initMap();
        saa.Tuulikartta.updateRadarData();

    </script>

</html>
